        :root {
            --parchment: #f4e4c1; --parchment-dark: #d4c4a1; --ink: #2c1810; --ink-light: #5c4830;
            --gold: #c9a227; --gold-dark: #8b7019; --sea-dark: #1a3a4a; --sea-medium: #2d5a6a;
            --sea-light: #4a8a9a; --blood-red: #8b2500; --wood: #6b4423; --wood-dark: #3d2512;
            --sail-white: #f5f0e1; --english: #c41e3a; --eitc: #1e4d2b; --pirates: #2c2c2c;
            --neutral: #5a5a5a; --modal-bg: rgba(20, 15, 10, 0.95); --card-bg: rgba(244, 228, 193, 0.95);
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.5); --shadow-light: 0 2px 10px rgba(0, 0, 0, 0.3);
            --font-display: 'Cinzel', serif; --font-body: 'Crimson Text', Georgia, serif;
            --space-xs: 4px; --space-sm: 8px; --space-md: 16px; --space-lg: 24px; --space-xl: 32px;
            --touch-min: 48px; --ease-out: cubic-bezier(0.23, 1, 0.32, 1);
            --action-stack-h: 200px; --action-stack-bottom: 20px;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; overflow: hidden; touch-action: manipulation; -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
        body { font-family: var(--font-body); font-size: 16px; line-height: 1.5; color: var(--ink); background: var(--sea-dark); }
        .hidden { display: none !important; }
    #loading-screen { position: fixed; inset: 0; background: linear-gradient(135deg, var(--sea-dark) 0%, #0d1f29 100%); display: flex; align-items: center; justify-content: center; z-index: 1000; }
    .loading-content { text-align: center; color: var(--parchment); }
    .loading-content h1 { font-family: var(--font-display); font-size: 2rem; font-weight: 700; letter-spacing: 0.1em; margin-bottom: var(--space-lg); text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); }
    .loading-ship { font-size: 3rem; animation: bob 2s ease-in-out infinite; margin-bottom: var(--space-lg); }
    @keyframes bob { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-10px) rotate(5deg); } }
    .loading-bar { width: 200px; height: 6px; background: rgba(255, 255, 255, 0.2); border-radius: 3px; margin: 0 auto; overflow: hidden; }
    .loading-progress { height: 100%; width: 0%; background: linear-gradient(90deg, var(--gold), var(--gold-dark)); border-radius: 3px; transition: width 0.3s var(--ease-out); }

    .screen { position: fixed; inset: 0; background: linear-gradient(180deg, var(--sea-dark) 0%, #0d1f29 100%); overflow-y: auto; z-index: 900; }
    .screen-content { min-height: 100%; padding: var(--space-xl) var(--space-md); display: flex; flex-direction: column; align-items: center; }
    .screen-content h1 { font-family: var(--font-display); font-size: 1.5rem; color: var(--parchment); text-align: center; margin-bottom: var(--space-sm); }
    .subtitle { color: var(--parchment-dark); text-align: center; max-width: 300px; margin-bottom: var(--space-xl); font-style: italic; }
    .faction-cards { display: flex; flex-direction: column; gap: var(--space-md); width: 100%; max-width: 400px; }
    .faction-card { background: var(--card-bg); border: 3px solid transparent; border-radius: 12px; padding: var(--space-md); text-align: center; cursor: pointer; transition: all 0.3s var(--ease-out); }
    .faction-card:hover, .faction-card:active { transform: translateY(-2px); box-shadow: var(--shadow); }
    .faction-card.selected { border-color: var(--gold); box-shadow: 0 0 20px rgba(201, 162, 39, 0.4); }
    .faction-icon { font-size: 2.5rem; margin-bottom: var(--space-xs); }
    .faction-card h2 { font-family: var(--font-display); font-size: 1.1rem; color: var(--ink); margin-bottom: var(--space-xs); }
    .faction-desc { color: var(--ink-light); font-style: italic; margin-bottom: var(--space-sm); font-size: 0.85rem; }
    .faction-perks { list-style: none; text-align: left; font-size: 0.8rem; }
    .faction-perks li { padding: 2px 0; color: var(--ink-light); }
    .difficulty-tag { display: inline-block; font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; margin-top: 4px; }
    .difficulty-easy { background: #1e7d34; color: white; }
    .difficulty-medium { background: var(--gold-dark); color: white; }
    .difficulty-hard { background: var(--blood-red); color: white; }

    .btn-primary, .btn-secondary, .btn-danger { font-family: var(--font-display); font-size: 0.95rem; padding: var(--space-md) var(--space-xl); border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s var(--ease-out); min-height: var(--touch-min); display: inline-flex; align-items: center; justify-content: center; gap: var(--space-sm); }
    .btn-primary { background: linear-gradient(180deg, var(--gold) 0%, var(--gold-dark) 100%); color: var(--ink); box-shadow: 0 3px 0 var(--wood-dark), var(--shadow-light); }
    .btn-primary:active { transform: translateY(2px); box-shadow: 0 1px 0 var(--wood-dark); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-secondary { background: var(--parchment); color: var(--ink); border: 2px solid var(--ink-light); }
    .btn-danger { background: linear-gradient(180deg, var(--blood-red) 0%, #5c1700 100%); color: var(--parchment); }
    .btn-small { font-size: 0.75rem; padding: var(--space-xs) var(--space-sm); min-height: 32px; }

    #game-container { position: fixed; inset: 0; overflow: hidden; }
    #game-canvas { position: absolute; inset: 0; width: 100%; height: 100%; touch-action: none; }

    #hud-top { position: fixed; top: 0; left: 0; right: 0; display: flex; justify-content: center; gap: var(--space-sm); padding: var(--space-sm); background: linear-gradient(180deg, rgba(0, 0, 0, 0.6) 0%, transparent 100%); pointer-events: none; z-index: 10; flex-wrap: wrap; }
    .hud-item { display: flex; align-items: center; gap: var(--space-xs); background: var(--card-bg); padding: 6px 12px; border-radius: 20px; font-family: var(--font-display); font-size: 0.8rem; box-shadow: var(--shadow-light); }
    .hud-icon { font-size: 1rem; }
    .hud-value { font-weight: 600; color: var(--ink); }

    #faction-badge { position: fixed; top: 50px; left: var(--space-sm); display: flex; align-items: center; gap: var(--space-xs); background: var(--card-bg); padding: 4px 10px; border-radius: 15px; font-family: var(--font-display); font-size: 0.7rem; box-shadow: var(--shadow-light); z-index: 10; }
    #faction-badge.english { border-left: 3px solid var(--english); }
    #faction-badge.eitc { border-left: 3px solid var(--eitc); }
    #faction-badge.pirates { border-left: 3px solid var(--pirates); }

    #cargo-summary { position: fixed; top: 80px; left: var(--space-sm); background: var(--card-bg); padding: 6px 10px; border-radius: 8px; font-size: 0.75rem; max-width: 120px; box-shadow: var(--shadow-light); z-index: 10; }
    .cargo-header { display: flex; justify-content: space-between; font-family: var(--font-display); font-size: 0.7rem; margin-bottom: 2px; color: var(--ink-light); }
    #cargo-preview { display: flex; flex-wrap: wrap; gap: 2px; }
    .cargo-dot { width: 6px; height: 6px; border-radius: 2px; background: var(--gold); }
    .cargo-dot.high-margin { animation: glow-dot 1.5s ease-in-out infinite; background: #1e7d34; }
    .cargo-dot.contraband { background: var(--blood-red); }
    @keyframes glow-dot { 0%, 100% { box-shadow: 0 0 2px #1e7d34; } 50% { box-shadow: 0 0 6px #1e7d34; } }

    #wind-indicator { position: fixed; top: 130px; left: var(--space-sm); background: var(--card-bg); padding: 4px 8px; border-radius: 8px; font-size: 0.7rem; box-shadow: var(--shadow-light); z-index: 10; display: flex; align-items: center; gap: 4px; }
    #wind-arrow { display: inline-block; transition: transform 0.5s ease; }

    /* Heat indicator - small bar below wind */
    #heat-indicator { position: fixed; top: 160px; left: var(--space-sm); background: var(--card-bg); padding: 4px 8px; border-radius: 8px; font-size: 0.65rem; box-shadow: var(--shadow-light); z-index: 10; display: flex; align-items: center; gap: 4px; }
    #heat-indicator .heat-bar { width: 40px; height: 4px; background: var(--parchment-dark); border-radius: 2px; overflow: hidden; }
    #heat-indicator .heat-fill { height: 100%; background: var(--blood-red); transition: width 0.3s; }
    #heat-indicator.low .heat-fill { background: #1e7d34; }
    #heat-indicator.med .heat-fill { background: var(--gold-dark); }
    #heat-indicator.high .heat-fill { background: var(--blood-red); }

    /* Bounty indicator - Living Sea Update */
    #bounty-indicator { position: fixed; top: 185px; left: var(--space-sm); background: var(--card-bg); padding: 4px 8px; border-radius: 8px; font-size: 0.65rem; box-shadow: var(--shadow-light); z-index: 10; display: flex; align-items: center; gap: 4px; }
    #bounty-indicator.clean { opacity: 0.5; }
    #bounty-indicator.wanted { border-left: 3px solid #da4; }
    #bounty-indicator.hunted { border-left: 3px solid #e83; animation: bounty-pulse 2s ease-in-out infinite; }
    #bounty-indicator.infamous { border-left: 3px solid #c33; animation: bounty-pulse 1s ease-in-out infinite; }
    @keyframes bounty-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }

    /* Notoriety indicator - Meta Pressure System */
    #notoriety-indicator { position: fixed; top: 205px; left: var(--space-sm); background: var(--card-bg); padding: 4px 8px; border-radius: 8px; font-size: 0.65rem; box-shadow: var(--shadow-light); z-index: 10; display: flex; align-items: center; gap: 4px; opacity: 0; transition: opacity 0.5s ease; }
    #notoriety-indicator.visible { opacity: 1; }
    #notoriety-indicator.low { border-left: 3px solid #5a7; }
    #notoriety-indicator.rising { border-left: 3px solid #da5; }
    #notoriety-indicator.high { border-left: 3px solid #e73; }
    #notoriety-indicator.notorious { border-left: 3px solid #c33; animation: notoriety-pulse 3s ease-in-out infinite; }
    @keyframes notoriety-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
    #notoriety-indicator .notoriety-bar { width: 35px; height: 4px; background: var(--parchment-dark); border-radius: 2px; overflow: hidden; }
    #notoriety-indicator .notoriety-fill { height: 100%; background: #5a7; transition: width 0.5s, background 0.5s; }
    #notoriety-indicator.rising .notoriety-fill { background: #da5; }
    #notoriety-indicator.high .notoriety-fill { background: #e73; }
    #notoriety-indicator.notorious .notoriety-fill { background: #c33; }

    /* Contract tracker chip */
    #contract-tracker { position: fixed; top: 215px; left: var(--space-sm); background: var(--card-bg); padding: 4px 8px; border-radius: 8px; font-size: 0.65rem; box-shadow: var(--shadow-light); z-index: 10; display: flex; align-items: center; gap: 4px; cursor: pointer; pointer-events: auto; max-width: 130px; border-left: 3px solid var(--gold); }
    #contract-tracker.hidden { display: none; }
    #contract-tracker .contract-title { font-family: var(--font-display); font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; }
    #contract-tracker .contract-meta { color: var(--ink-light); font-size: 0.6rem; }

    /* Season/World indicator */
    #world-indicator { position: fixed; top: 220px; left: var(--space-sm); background: var(--card-bg); padding: 4px 8px; border-radius: 8px; font-size: 0.6rem; box-shadow: var(--shadow-light); z-index: 10; display: flex; align-items: center; gap: 4px; }
    #world-indicator.storm-season { border-left: 3px solid var(--sea-medium); }
    #world-indicator.crackdown { border-left: 3px solid var(--blood-red); }

    /* Ship condition HUD - Living Sea Update */
    #ship-condition { position: fixed; top: 250px; left: var(--space-sm); background: var(--card-bg); padding: 6px 10px; border-radius: 8px; font-size: 0.6rem; box-shadow: var(--shadow-light); z-index: 10; min-width: 100px; }
    #ship-condition .ship-class-name { font-family: var(--font-display); font-weight: 600; font-size: 0.7rem; margin-bottom: 4px; display: flex; align-items: center; gap: 4px; }
    #ship-condition .condition-row { display: flex; align-items: center; gap: 6px; margin: 3px 0; }
    #ship-condition .condition-icon { width: 14px; text-align: center; }
    #ship-condition .condition-bar { flex: 1; height: 6px; background: var(--parchment-dark); border-radius: 3px; overflow: hidden; }
    #ship-condition .condition-fill { height: 100%; transition: width 0.3s, background 0.3s; }
    #ship-condition .condition-fill.hull { background: #8B4513; }
    #ship-condition .condition-fill.rigging { background: #D2B48C; }
    #ship-condition .condition-fill.morale { background: #4682B4; }
    #ship-condition .condition-fill.critical { background: var(--blood-red) !important; animation: pulse-critical 1s infinite; }
    #ship-condition .condition-value { width: 28px; text-align: right; font-family: var(--font-display); font-size: 0.6rem; }
    #ship-condition.critical { border: 2px solid var(--blood-red); }
    @keyframes pulse-critical { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

    #compass { position: fixed; top: 50px; right: var(--space-sm); display: flex; flex-direction: column; align-items: center; gap: var(--space-xs); z-index: 10; }
    .compass-ring { width: 60px; height: 60px; border-radius: 50%; background: var(--card-bg); border: 3px solid var(--wood); position: relative; box-shadow: var(--shadow-light); }
    .compass-needle { position: absolute; top: 50%; left: 50%; width: 3px; height: 24px; background: linear-gradient(180deg, var(--blood-red) 50%, var(--ink) 50%); transform-origin: center bottom; transform: translate(-50%, -100%); border-radius: 2px; transition: transform 0.3s var(--ease-out); }
    .compass-dest-marker { position: absolute; width: 8px; height: 8px; background: var(--gold); border-radius: 50%; top: 5px; left: 50%; transform: translateX(-50%); box-shadow: 0 0 6px var(--gold); }
    .compass-n, .compass-e, .compass-s, .compass-w { position: absolute; font-family: var(--font-display); font-size: 0.6rem; font-weight: 700; color: var(--ink-light); }
    .compass-n { top: 3px; left: 50%; transform: translateX(-50%); color: var(--blood-red); }
    .compass-s { bottom: 3px; left: 50%; transform: translateX(-50%); }
    .compass-e { right: 5px; top: 50%; transform: translateY(-50%); }
    .compass-w { left: 5px; top: 50%; transform: translateY(-50%); }
    #destination-info { background: var(--card-bg); padding: 3px 8px; border-radius: 4px; text-align: center; font-size: 0.65rem; box-shadow: var(--shadow-light); }
    #dest-name { display: block; font-family: var(--font-display); font-weight: 600; }
    #dest-distance { color: var(--ink-light); }

    #mobile-controls { position: fixed; bottom: 0; left: 0; right: 0; height: 180px; pointer-events: none; z-index: 20; }
    #joystick-zone { position: absolute; bottom: 20px; left: 20px; width: 120px; height: 120px; pointer-events: auto; }
    #joystick-base { position: absolute; width: 120px; height: 120px; border-radius: 50%; background: radial-gradient(circle, rgba(244,228,193,0.3) 0%, rgba(244,228,193,0.1) 70%, transparent 100%); border: 3px solid rgba(244,228,193,0.5); }
    #joystick-stick { position: absolute; width: 50px; height: 50px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, var(--parchment) 0%, var(--gold-dark) 100%); border: 3px solid var(--wood); box-shadow: 0 4px 8px rgba(0,0,0,0.4); left: 50%; top: 50%; transform: translate(-50%, -50%); }
    #joystick-stick.active { box-shadow: 0 2px 4px rgba(0,0,0,0.4), 0 0 15px rgba(201,162,39,0.5); }

    #action-buttons { position: absolute; bottom: var(--action-stack-bottom); right: 20px; display: flex; flex-direction: column; gap: 10px; pointer-events: auto; }
    .action-btn { width: 60px; height: 60px; border-radius: 50%; border: 3px solid var(--wood); font-size: 1.5rem; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.15s ease; box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
    .action-btn:active { transform: scale(0.95); }
    #btn-dock { background: linear-gradient(180deg, var(--sea-light) 0%, var(--sea-medium) 100%); color: white; }
    #btn-dock.available { animation: pulse-dock 1.5s ease-in-out infinite; }
    @keyframes pulse-dock { 0%, 100% { box-shadow: 0 4px 8px rgba(0,0,0,0.4); } 50% { box-shadow: 0 4px 8px rgba(0,0,0,0.4), 0 0 0 10px rgba(74,138,154,0.3); } }
    #btn-map { background: linear-gradient(180deg, var(--parchment) 0%, var(--parchment-dark) 100%); color: var(--ink); }
    #btn-menu { background: linear-gradient(180deg, var(--gold) 0%, var(--gold-dark) 100%); color: var(--ink); }

    #speed-indicator { position: absolute; bottom: 150px; left: 30px; background: var(--card-bg); padding: 4px 10px; border-radius: 12px; font-family: var(--font-display); font-size: 0.7rem; box-shadow: var(--shadow-light); display: flex; align-items: center; gap: 5px; pointer-events: none; }
    #speed-indicator .bar { width: 40px; height: 6px; background: var(--parchment-dark); border-radius: 3px; overflow: hidden; }
    #speed-indicator .bar-fill { height: 100%; background: var(--gold); width: 0%; transition: width 0.2s; }
    .wind-boost { color: #1e7d34; font-size: 0.6rem; }
    .wind-penalty { color: var(--blood-red); font-size: 0.6rem; }

    /* Fixed: island indicator positioned above action buttons */
    #island-indicator { position: absolute; bottom: calc(var(--action-stack-bottom) + var(--action-stack-h) + 15px); right: 20px; background: var(--card-bg); padding: 6px 12px; border-radius: 8px; font-family: var(--font-display); font-size: 0.75rem; box-shadow: var(--shadow-light); text-align: right; pointer-events: none; opacity: 0; transition: opacity 0.3s; }
    #island-indicator.visible { opacity: 1; }

    #event-toast { position: fixed; top: 120px; left: 50%; transform: translateX(-50%); background: var(--card-bg); padding: var(--space-sm) var(--space-md); border-radius: 8px; display: flex; align-items: center; gap: var(--space-sm); box-shadow: var(--shadow); z-index: 20; animation: slideDown 0.3s var(--ease-out); max-width: calc(100% - 40px); }
    @keyframes slideDown { from { transform: translateX(-50%) translateY(-20px); opacity: 0; } to { transform: translateX(-50%) translateY(0); opacity: 1; } }
    .event-icon { font-size: 1.3rem; }
    .event-text { display: flex; flex-direction: column; }
    #event-title { font-family: var(--font-display); font-size: 0.85rem; }
    #event-desc { font-size: 0.75rem; color: var(--ink-light); }

    .modal { position: fixed; inset: 0; background: var(--modal-bg); display: flex; align-items: center; justify-content: center; padding: var(--space-sm); z-index: 100; animation: fadeIn 0.2s var(--ease-out); }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .modal-content { background: var(--parchment); border-radius: 12px; width: 100%; max-width: 400px; max-height: 85vh; overflow-y: auto; position: relative; box-shadow: var(--shadow); }

    .modal-header { padding: var(--space-md); border-bottom: 2px solid var(--parchment-dark); position: relative; }
    .modal-header h2 { font-family: var(--font-display); font-size: 1.1rem; margin-bottom: var(--space-xs); padding-right: 30px; }
    .island-info { display: flex; gap: var(--space-xs); flex-wrap: wrap; }
    .faction-tag { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; background: var(--ink-light); color: var(--parchment); }
    .faction-tag.english { background: var(--english); }
    .faction-tag.eitc { background: var(--eitc); }
    .faction-tag.pirates { background: var(--pirates); }
    .faction-tag.neutral { background: var(--neutral); }
    .tariff-tag { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; background: var(--gold-dark); color: var(--parchment); }
    .port-state-tag { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; background: var(--sea-medium); color: var(--parchment); }
    .port-state-tag.prosperous { background: #1e7d34; }
    .port-state-tag.struggling { background: var(--gold-dark); }
    .port-state-tag.blockaded { background: #8b2500; }
    .port-state-tag.lawless { background: #2c2c2c; }
    .port-state-tag.starving { background: #5c1700; }
    .port-state-tag.flooded { background: var(--sea-dark); }
    .modal-close { position: absolute; top: var(--space-sm); right: var(--space-sm); width: 32px; height: 32px; border: none; background: transparent; font-size: 1.3rem; cursor: pointer; color: var(--ink-light); }

    .trade-tabs { display: flex; border-bottom: 2px solid var(--parchment-dark); }
    .trade-tab { flex: 1; padding: var(--space-sm); background: transparent; border: none; font-family: var(--font-display); font-size: 0.75rem; cursor: pointer; color: var(--ink-light); position: relative; }
    .trade-tab.active { color: var(--ink); }
    .trade-tab.active::after { content: ''; position: absolute; bottom: -2px; left: 0; right: 0; height: 3px; background: var(--gold); }
    .trade-tab .tab-badge { display: inline-block; background: var(--blood-red); color: white; font-size: 0.55rem; padding: 1px 4px; border-radius: 8px; margin-left: 2px; vertical-align: top; }

    .trade-panel { padding: var(--space-sm); max-height: 40vh; overflow-y: auto; }
    .goods-list { display: flex; flex-direction: column; gap: var(--space-xs); }
    .good-item { display: grid; grid-template-columns: 1fr auto; grid-template-rows: auto auto; gap: 2px var(--space-sm); padding: var(--space-sm); background: rgba(255, 255, 255, 0.5); border-radius: 6px; border: 1px solid var(--parchment-dark); }
    .good-item.blocked { opacity: 0.6; }
    .good-info { display: flex; align-items: center; gap: var(--space-xs); }
    .good-icon { font-size: 1.2rem; }
    .good-name { font-family: var(--font-display); font-size: 0.85rem; }
    .good-price { font-weight: 600; color: var(--gold-dark); font-size: 0.85rem; }
    .price-trend { font-size: 0.75rem; margin-left: 2px; }
    .price-trend.up { color: #c41e3a; }
    .price-trend.down { color: #1e7d34; }
    .good-details { grid-column: 1; font-size: 0.7rem; color: var(--ink-light); }
    .good-actions { grid-column: 2; grid-row: 1 / 3; display: flex; align-items: center; gap: 4px; }
    .qty-btn { width: 36px; height: 36px; border: 2px solid var(--ink-light); border-radius: 6px; background: var(--parchment); font-size: 1.2rem; cursor: pointer; }
    .qty-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    .qty-btn.sell { background: linear-gradient(180deg, #ffcccc 0%, #ffaaaa 100%); }
    .qty-btn.buy { background: linear-gradient(180deg, #ccffcc 0%, #aaffaa 100%); }
    .block-reason { color: var(--blood-red); font-size: 0.65rem; }

    .panel-actions { display: flex; gap: var(--space-xs); margin-bottom: var(--space-sm); }
    .panel-actions button { flex: 1; }

    .trade-footer { padding: var(--space-sm) var(--space-md); border-top: 2px solid var(--parchment-dark); display: flex; justify-content: space-between; align-items: center; }
    .player-stats { display: flex; gap: var(--space-md); font-size: 0.8rem; }

    /* Contract cards */
    .contract-card { background: rgba(255,255,255,0.6); border: 2px solid var(--parchment-dark); border-radius: 8px; padding: var(--space-sm); margin-bottom: var(--space-sm); }
    .contract-card.active { border-color: var(--gold); background: rgba(201,162,39,0.1); }
    .contract-card.tracked { border-color: var(--sea-medium); box-shadow: 0 0 8px rgba(74,138,154,0.4); }
    .contract-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-xs); }
    .contract-type { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; background: var(--ink-light); color: var(--parchment); }
    .contract-type.delivery { background: var(--sea-medium); }
    .contract-type.smuggling { background: var(--blood-red); }
    .contract-type.courier { background: var(--gold-dark); }
    .contract-type.supply { background: #1e7d34; }
    .contract-type.faction { background: var(--pirates); }
    .contract-title { font-family: var(--font-display); font-size: 0.85rem; flex: 1; margin-right: var(--space-xs); }
    .contract-deadline { font-size: 0.7rem; color: var(--ink-light); }
    .contract-deadline.urgent { color: var(--blood-red); font-weight: 600; }
    .contract-details { font-size: 0.75rem; color: var(--ink-light); margin-bottom: var(--space-xs); }
    .contract-rewards { display: flex; gap: var(--space-sm); font-size: 0.75rem; margin-bottom: var(--space-xs); }
    .contract-reward { display: flex; align-items: center; gap: 2px; }
    .contract-reward.gold { color: var(--gold-dark); }
    .contract-reward.rep { color: var(--sea-medium); }
    .contract-cost { font-size: 0.7rem; color: var(--blood-red); margin-bottom: var(--space-xs); font-style: italic; }
    .contract-actions { display: flex; gap: var(--space-xs); }
    .contract-actions button { flex: 1; }
    .contract-empty { text-align: center; color: var(--ink-light); padding: var(--space-lg); font-style: italic; }

    /* Questline Cards - Living Sea Update */
    .questline-card { background: linear-gradient(135deg, rgba(74, 108, 124, 0.15) 0%, rgba(44, 78, 94, 0.1) 100%); border: 2px solid var(--sea-medium); border-radius: 8px; padding: var(--space-sm); margin-bottom: var(--space-sm); }
    .questline-card.active { border-color: var(--gold); background: linear-gradient(135deg, rgba(201, 162, 39, 0.2) 0%, rgba(201, 162, 39, 0.1) 100%); }
    .questline-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xs); }
    .questline-title { font-family: var(--font-display); font-size: 0.9rem; display: flex; align-items: center; gap: var(--space-xs); }
    .questline-deadline { font-size: 0.7rem; color: var(--blood-red); font-weight: 600; }
    .questline-tier { font-size: 0.6rem; background: var(--sea-medium); color: white; padding: 2px 6px; border-radius: 4px; margin-left: 4px; }
    .questline-desc { font-size: 0.75rem; color: var(--ink-light); margin-bottom: var(--space-sm); }
    .questline-steps { margin-bottom: var(--space-sm); }
    .questline-step { display: flex; align-items: flex-start; gap: var(--space-xs); font-size: 0.75rem; padding: var(--space-xs) 0; }
    .questline-step.completed { color: #1e7d34; text-decoration: line-through; opacity: 0.7; }
    .questline-step.current { font-weight: 600; color: var(--sea-dark); }
    .questline-step.pending { color: var(--ink-light); }
    .step-icon { width: 16px; text-align: center; }
    .questline-rewards { display: flex; flex-wrap: wrap; gap: var(--space-sm); font-size: 0.7rem; margin-bottom: var(--space-sm); background: rgba(201, 162, 39, 0.1); padding: var(--space-xs); border-radius: 4px; }
    .questline-actions { display: flex; gap: var(--space-xs); }
    .questline-empty { text-align: center; color: var(--ink-light); padding: var(--space-md); font-style: italic; }

    .logbook-section { margin-bottom: var(--space-md); }
    .logbook-section h4 { font-family: var(--font-display); font-size: 0.85rem; margin-bottom: var(--space-xs); color: var(--ink-light); }
    .island-select { width: 100%; padding: var(--space-sm); border: 2px solid var(--parchment-dark); border-radius: 6px; font-family: var(--font-body); background: white; margin-bottom: var(--space-sm); }
    .logbook-item { display: flex; justify-content: space-between; align-items: center; padding: var(--space-xs) var(--space-sm); background: rgba(255,255,255,0.5); border-radius: 4px; margin-bottom: 2px; font-size: 0.8rem; }
    .confidence-tag { font-size: 0.6rem; padding: 1px 4px; border-radius: 3px; margin-left: 4px; }
    .confidence-high { background: #1e7d34; color: white; }
    .confidence-med { background: var(--gold-dark); color: white; }
    .confidence-low { background: var(--ink-light); color: white; }

    .spotlight-card { background: linear-gradient(135deg, rgba(201,162,39,0.2) 0%, rgba(201,162,39,0.1) 100%); border: 2px solid var(--gold); border-radius: 8px; padding: var(--space-sm); margin-bottom: var(--space-sm); cursor: pointer; }
    .spotlight-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-light); }
    .spotlight-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xs); }
    .spotlight-good { font-family: var(--font-display); font-size: 0.9rem; }
    .spotlight-profit { color: #1e7d34; font-weight: 600; }
    .spotlight-route { font-size: 0.75rem; color: var(--ink-light); }
    .spotlight-empty { text-align: center; color: var(--ink-light); padding: var(--space-md); font-style: italic; }

    .upgrade-card { background: rgba(255,255,255,0.5); border: 2px solid var(--parchment-dark); border-radius: 8px; padding: var(--space-sm); margin-bottom: var(--space-sm); }
    .upgrade-card.owned { border-color: var(--gold); background: rgba(201,162,39,0.1); }
    .upgrade-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xs); }
    .upgrade-name { font-family: var(--font-display); font-size: 0.9rem; }
    .upgrade-cost { color: var(--gold-dark); font-weight: 600; }
    .upgrade-desc { font-size: 0.75rem; color: var(--ink-light); margin-bottom: var(--space-xs); }
    .upgrade-stats { font-size: 0.65rem; display: flex; flex-wrap: wrap; gap: var(--space-xs); margin-bottom: var(--space-xs); }
    .upgrade-stat { padding: 2px 6px; border-radius: 4px; }
    .upgrade-stat.positive { background: rgba(30,125,52,0.2); color: #1e7d34; }
    .upgrade-stat.negative { background: rgba(139,37,0,0.2); color: var(--blood-red); }

    /* Ship Repairs - Living Sea Update */
    .shipyard-section { margin-bottom: var(--space-md); }
    .shipyard-section h4 { font-family: var(--font-display); font-size: 0.85rem; margin-bottom: var(--space-sm); color: var(--ink); border-bottom: 1px solid var(--parchment-dark); padding-bottom: var(--space-xs); }
    .repair-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: var(--space-sm); }
    .repair-card { background: rgba(255,255,255,0.5); border: 2px solid var(--parchment-dark); border-radius: 8px; padding: var(--space-sm); text-align: center; }
    .repair-card.full { border-color: #1e7d34; background: rgba(30,125,52,0.1); }
    .repair-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xs); font-size: 0.8rem; }
    .repair-bar { height: 8px; background: var(--parchment-dark); border-radius: 4px; overflow: hidden; margin-bottom: var(--space-xs); }
    .repair-fill { height: 100%; transition: width 0.3s; }
    .repair-fill.hull { background: #8B4513; }
    .repair-fill.rigging { background: #D2B48C; }
    .repair-fill.morale { background: #4682B4; }
    .repair-full { font-size: 0.7rem; color: #1e7d34; font-style: italic; }

    /* Pardon Card - Living Sea Update */
    .pardon-card { background: rgba(139, 0, 0, 0.1); border: 2px solid var(--blood-red); border-radius: 8px; padding: var(--space-sm); text-align: center; }
    .pardon-status { display: flex; align-items: center; justify-content: center; gap: var(--space-sm); margin-bottom: var(--space-sm); font-size: 1rem; }
    .bounty-icon { font-size: 1.2rem; }
    .bounty-level { font-weight: bold; font-family: var(--font-display); }
    .bounty-amount { font-size: 0.8rem; color: var(--ink-light); }
    .pardon-desc { font-size: 0.75rem; color: var(--ink-light); margin-bottom: var(--space-sm); }

    /* Officer Cards - Living Sea Update */
    .officer-card { background: rgba(255,255,255,0.6); border: 2px solid var(--parchment-dark); border-radius: 8px; padding: var(--space-sm); margin-bottom: var(--space-sm); }
    .officer-card.hired { border-color: var(--gold); background: rgba(201,162,39,0.15); }
    .officer-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xs); }
    .officer-name { font-family: var(--font-display); font-size: 0.9rem; display: flex; align-items: center; gap: var(--space-xs); }
    .officer-type { font-size: 0.7rem; color: var(--ink-light); background: var(--parchment-dark); padding: 2px 6px; border-radius: 4px; }
    .officer-wage { color: var(--gold-dark); font-weight: 600; font-size: 0.8rem; }
    .officer-traits { display: flex; flex-wrap: wrap; gap: var(--space-xs); margin: var(--space-xs) 0; }
    .officer-trait { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; }
    .officer-trait.positive { background: rgba(30,125,52,0.2); color: #1e7d34; }
    .officer-trait.negative { background: rgba(139,37,0,0.2); color: var(--blood-red); }
    .officer-actions { display: flex; gap: var(--space-xs); margin-top: var(--space-xs); }
    .officers-empty { text-align: center; color: var(--ink-light); padding: var(--space-md); font-style: italic; }
    .rumor-card { display: flex; align-items: flex-start; gap: var(--space-xs); background: rgba(255,255,255,0.5); border-radius: 6px; padding: var(--space-xs) var(--space-sm); margin-bottom: var(--space-xs); font-size: 0.75rem; }
    .rumor-card.rumor-true { border-left: 3px solid #1e7d34; }
    .rumor-card.rumor-false { border-left: 3px solid #8b6914; }
    .rumor-icon { font-size: 1rem; }
    .rumor-text { flex: 1; font-style: italic; color: var(--ink); }
    .rumor-age { font-size: 0.65rem; color: var(--ink-light); background: var(--parchment-dark); padding: 2px 6px; border-radius: 4px; }

    /* Ship Cards - Living Sea Update */
    .ship-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: var(--space-sm); margin-bottom: var(--space-md); }
    .ship-card { background: rgba(255,255,255,0.6); border: 2px solid var(--parchment-dark); border-radius: 8px; padding: var(--space-sm); }
    .ship-card.owned { border-color: var(--gold); background: rgba(201,162,39,0.15); }
    .ship-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xs); }
    .ship-name { font-family: var(--font-display); font-size: 0.9rem; }
    .ship-cost { color: var(--gold-dark); font-weight: 600; font-size: 0.8rem; }
    .ship-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 2px; font-size: 0.7rem; margin-bottom: var(--space-xs); }
    .ship-stat { display: flex; justify-content: space-between; padding: 2px 4px; background: rgba(0,0,0,0.05); border-radius: 3px; }
    .ship-stat span:first-child { color: var(--ink-light); }
    .ship-stat span:last-child { font-weight: 600; }
    .ship-desc { font-size: 0.65rem; color: var(--ink-light); margin: var(--space-xs) 0; font-style: italic; }

    .menu-content { padding: var(--space-md); }
    .menu-content h2 { font-family: var(--font-display); text-align: center; margin-bottom: var(--space-md); }
    .menu-section { margin-bottom: var(--space-md); }
    .menu-section h3 { font-family: var(--font-display); font-size: 0.9rem; margin-bottom: var(--space-sm); color: var(--ink-light); }
    .reputation-bars { display: flex; flex-direction: column; gap: var(--space-sm); }
    .rep-item { display: grid; grid-template-columns: 1fr 1fr auto; align-items: center; gap: var(--space-xs); font-size: 0.75rem; }
    .rep-bar { height: 6px; background: var(--parchment-dark); border-radius: 3px; overflow: hidden; }
    .rep-fill { height: 100%; background: var(--gold); width: 50%; }
    .rep-fill.hostile { background: var(--blood-red); }
    .rep-fill.friendly { background: #1e7d34; }
    .ship-stats { background: rgba(255, 255, 255, 0.5); border-radius: 6px; padding: var(--space-sm); }
    .stat-row { display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px solid var(--parchment-dark); font-size: 0.8rem; }
    .stat-row:last-child { border-bottom: none; }
    .risk-low { color: #1e7d34; }
    .risk-med { color: var(--gold-dark); }
    .risk-high { color: var(--blood-red); }
    .menu-buttons { display: flex; flex-direction: column; gap: var(--space-xs); margin-bottom: var(--space-md); }

    /* Titles section */
    .title-item { display: flex; justify-content: space-between; align-items: center; padding: var(--space-xs) var(--space-sm); background: rgba(255,255,255,0.5); border-radius: 4px; margin-bottom: 2px; font-size: 0.8rem; }
    .title-name { font-family: var(--font-display); }
    .title-tier { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; background: var(--gold); color: var(--ink); }
    .title-tier.tier-0 { background: var(--ink-light); color: var(--parchment); }
    .title-tier.tier-1 { background: #cd7f32; color: white; }
    .title-tier.tier-2 { background: #c0c0c0; color: var(--ink); }
    .title-tier.tier-3 { background: var(--gold); color: var(--ink); }
    .title-tier.tier-4 { background: #b9f2ff; color: var(--ink); }
    .title-tier.tier-5 { background: var(--blood-red); color: white; }
    .title-progress { font-size: 0.65rem; color: var(--ink-light); }

    .pirate-content, .encounter-content, .warning-content { padding: var(--space-lg); text-align: center; }
    .pirate-icon, .encounter-icon, .warning-icon { font-size: 3rem; margin-bottom: var(--space-sm); }
    .pirate-icon { animation: shake 0.5s ease-in-out infinite; }
    @keyframes shake { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }
    .pirate-content h2, .encounter-content h2, .warning-content h2 { font-family: var(--font-display); margin-bottom: var(--space-sm); }
    .pirate-content > p, .encounter-content > p, .warning-content > p { margin-bottom: var(--space-lg); color: var(--ink-light); }
    .pirate-options, .encounter-options { display: flex; flex-direction: column; gap: var(--space-sm); }
    .encounter-reward { background: rgba(30,125,52,0.1); border: 1px solid #1e7d34; border-radius: 6px; padding: var(--space-sm); margin-bottom: var(--space-md); }
    .encounter-penalty { background: rgba(139,37,0,0.1); border: 1px solid var(--blood-red); border-radius: 6px; padding: var(--space-sm); margin-bottom: var(--space-md); }

    /* Chase System - Living Sea Update */
    .chase-content { padding: var(--space-lg); text-align: center; }
    .chase-header { display: flex; align-items: center; justify-content: center; gap: var(--space-sm); margin-bottom: var(--space-sm); }
    .chase-icon { font-size: 2.5rem; animation: chase-bounce 0.8s ease-in-out infinite; }
    @keyframes chase-bounce { 0%, 100% { transform: translateX(-5px); } 50% { transform: translateX(5px); } }
    .chase-content h2 { font-family: var(--font-display); margin: 0; }
    .chase-desc { color: var(--ink-light); margin-bottom: var(--space-md); }
    .chase-progress { margin-bottom: var(--space-md); }
    .chase-bar { position: relative; height: 40px; background: linear-gradient(90deg, rgba(30,125,52,0.3), rgba(139,37,0,0.3)); border-radius: 20px; border: 2px solid var(--parchment-dark); overflow: visible; }
    .chase-player { position: absolute; left: 20%; top: 50%; transform: translate(-50%, -50%); font-size: 1.5rem; transition: left 0.3s ease-out; z-index: 2; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
    .chase-pirate { position: absolute; right: 10%; top: 50%; transform: translateY(-50%); font-size: 1.5rem; animation: chase-pirate-approach 1s ease-in-out infinite; z-index: 1; }
    @keyframes chase-pirate-approach { 0%, 100% { transform: translateY(-50%) translateX(0); } 50% { transform: translateY(-50%) translateX(-8px); } }
    .chase-labels { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--ink-light); margin-top: var(--space-xs); }
    .chase-stats { display: flex; justify-content: center; gap: var(--space-lg); margin-bottom: var(--space-md); }
    .chase-stat { font-size: 0.8rem; }
    .chase-stat span:first-child { color: var(--ink-light); margin-right: var(--space-xs); }
    .chase-stat span:last-child { font-weight: 600; font-family: var(--font-display); }
    .chase-actions { display: flex; flex-direction: column; gap: var(--space-sm); }
    .chase-action { padding: var(--space-sm) var(--space-md); font-size: 0.85rem; }
    .chase-action:disabled { opacity: 0.5; cursor: not-allowed; }
    .chase-result { margin-top: var(--space-md); padding: var(--space-md); border-radius: 8px; font-family: var(--font-display); }
    .chase-result.escaped { background: rgba(30,125,52,0.2); border: 2px solid #1e7d34; color: #1e7d34; }
    .chase-result.caught { background: rgba(139,37,0,0.2); border: 2px solid var(--blood-red); color: var(--blood-red); }

    .map-content { padding: var(--space-md); }
    .map-content h2 { font-family: var(--font-display); text-align: center; margin-bottom: var(--space-md); }
    #map-container { width: 100%; height: 250px; background: var(--sea-dark); border-radius: 8px; position: relative; overflow: hidden; }
    .map-island { position: absolute; width: 24px; height: 24px; border-radius: 50%; border: 2px solid var(--parchment); transform: translate(-50%, -50%); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; color: white; font-weight: bold; }
    .map-island:hover { transform: translate(-50%, -50%) scale(1.2); }
    .map-island.selected { box-shadow: 0 0 0 3px var(--gold), 0 0 10px var(--gold); }
    .map-island.english { background: var(--english); }
    .map-island.eitc { background: var(--eitc); }
    .map-island.pirates { background: var(--pirates); }
    .map-island.neutral { background: var(--neutral); }
    .map-player { position: absolute; width: 12px; height: 12px; background: var(--gold); border-radius: 50%; border: 2px solid white; transform: translate(-50%, -50%); box-shadow: 0 0 10px var(--gold); z-index: 5; }
    .map-drift-entity { position: absolute; width: 18px; height: 18px; border-radius: 50%; transform: translate(-50%, -50%); display: flex; align-items: center; justify-content: center; font-size: 0.7rem; z-index: 3; animation: drift-pulse 2s ease-in-out infinite; pointer-events: none; }
    @keyframes drift-pulse { 0%, 100% { opacity: 0.8; transform: translate(-50%, -50%) scale(1); } 50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); } }
    .map-course-line { position: absolute; height: 2px; background: var(--gold); transform-origin: left center; opacity: 0.6; z-index: 4; }
    .map-legend { display: flex; justify-content: center; gap: var(--space-md); margin-top: var(--space-sm); font-size: 0.7rem; flex-wrap: wrap; }
    .map-legend span { display: flex; align-items: center; gap: 4px; }
    .legend-dot { width: 10px; height: 10px; border-radius: 50%; }
    .map-buttons { display: flex; gap: var(--space-sm); margin-top: var(--space-md); }
    .map-buttons button { flex: 1; }
    .map-info { text-align: center; margin-top: var(--space-sm); font-size: 0.75rem; color: var(--ink-light); }

    /* Faction Influence Zones - Living Sea Update */
    .map-influence-zone { position: absolute; border-radius: 50%; transform: translate(-50%, -50%); opacity: 0.2; pointer-events: none; z-index: 1; transition: all 0.5s ease; }
    .map-influence-zone.english { background: radial-gradient(circle, var(--english) 0%, transparent 70%); }
    .map-influence-zone.eitc { background: radial-gradient(circle, var(--eitc) 0%, transparent 70%); }
    .map-influence-zone.pirates { background: radial-gradient(circle, var(--pirates) 0%, transparent 70%); }
    .map-influence-zone.contested { background: radial-gradient(circle, #8b4513 0%, transparent 70%); animation: contested-pulse 2s ease-in-out infinite; }
    @keyframes contested-pulse { 0%, 100% { opacity: 0.15; } 50% { opacity: 0.3; } }
    .map-island.blockaded { box-shadow: 0 0 0 4px var(--blood-red), 0 0 12px var(--blood-red); animation: blockade-pulse 1.5s ease-in-out infinite; }
    .map-island.warzone { box-shadow: 0 0 0 4px #ff6600, 0 0 15px #ff6600; animation: warzone-pulse 1s ease-in-out infinite; }
    @keyframes blockade-pulse { 0%, 100% { box-shadow: 0 0 0 4px var(--blood-red), 0 0 8px var(--blood-red); } 50% { box-shadow: 0 0 0 6px var(--blood-red), 0 0 16px var(--blood-red); } }
    @keyframes warzone-pulse { 0%, 100% { box-shadow: 0 0 0 4px #ff6600, 0 0 10px #ff6600; } 50% { box-shadow: 0 0 0 6px #ff8800, 0 0 20px #ff8800; } }
    .map-blockade-line { position: absolute; height: 3px; background: repeating-linear-gradient(90deg, var(--blood-red) 0px, var(--blood-red) 5px, transparent 5px, transparent 10px); transform-origin: left center; opacity: 0.8; z-index: 2; pointer-events: none; }
    .map-legend .legend-contested { background: linear-gradient(90deg, var(--english), var(--pirates)); }
    .map-overlay-toggle { position: absolute; top: 5px; right: 5px; background: var(--card-bg); border: 1px solid var(--parchment-dark); border-radius: 4px; padding: 2px 6px; font-size: 0.6rem; cursor: pointer; z-index: 10; }
    .map-overlay-toggle.active { background: var(--gold); }
    .influence-bar { display: flex; height: 6px; border-radius: 3px; overflow: hidden; margin-top: 2px; }
    .influence-bar .influence-segment { height: 100%; transition: width 0.3s; }
    .influence-bar .english { background: var(--english); }
    .influence-bar .eitc { background: var(--eitc); }
    .influence-bar .pirates { background: var(--pirates); }

    /* Hidden Coves - Living Sea Update */
    .map-cove { position: absolute; width: 20px; height: 20px; border-radius: 4px; border: 2px dashed var(--gold); transform: translate(-50%, -50%); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; background: rgba(201, 162, 39, 0.3); z-index: 4; animation: cove-shimmer 3s ease-in-out infinite; }
    .map-cove:hover { transform: translate(-50%, -50%) scale(1.2); box-shadow: 0 0 10px var(--gold); }
    .map-cove.selected { box-shadow: 0 0 0 3px var(--gold), 0 0 15px var(--gold); }
    @keyframes cove-shimmer { 0%, 100% { opacity: 0.8; } 50% { opacity: 1; border-color: #ffd700; } }
    .cove-modal-content { padding: var(--space-lg); text-align: center; }
    .cove-icon { font-size: 3rem; margin-bottom: var(--space-sm); }
    .cove-modal-content h2 { font-family: var(--font-display); margin-bottom: var(--space-xs); }
    .cove-modal-content .cove-desc { color: var(--ink-light); margin-bottom: var(--space-md); font-style: italic; }
    .cove-services { display: flex; flex-direction: column; gap: var(--space-sm); margin-top: var(--space-md); }
    .cove-service-btn { padding: var(--space-sm) var(--space-md); }
    .chart-fragment-indicator { position: fixed; top: 280px; left: var(--space-sm); background: var(--card-bg); padding: 4px 8px; border-radius: 8px; font-size: 0.65rem; box-shadow: var(--shadow-light); z-index: 10; display: flex; align-items: center; gap: 4px; border-left: 3px solid var(--gold); }
    .chart-fragment-indicator.can-reveal { animation: fragment-glow 1.5s ease-in-out infinite; }
    @keyframes fragment-glow { 0%, 100% { box-shadow: var(--shadow-light); } 50% { box-shadow: 0 0 10px var(--gold); } }

    @media (max-height: 500px) and (orientation: landscape) {
        :root { --action-stack-h: 160px; --action-stack-bottom: 10px; }
        #mobile-controls { height: 140px; }
        #joystick-zone { width: 100px; height: 100px; bottom: 10px; left: 10px; }
        #joystick-base { width: 100px; height: 100px; }
        #joystick-stick { width: 40px; height: 40px; }
        .action-btn { width: 50px; height: 50px; font-size: 1.2rem; }
        #action-buttons { bottom: var(--action-stack-bottom); right: 10px; gap: 8px; }
    }

    /* ==================== LEADERBOARD STYLES ==================== */
    .leaderboard-content { max-width: 500px; }
    .leaderboard-content .modal-header { display: flex; justify-content: space-between; align-items: center; }
    .leaderboard-content .modal-header h2 { margin: 0; padding-right: 0; }

    .leaderboard-player-section {
        padding: var(--space-sm) var(--space-md);
        background: rgba(255, 255, 255, 0.5);
        border-bottom: 2px solid var(--parchment-dark);
    }
    .player-name-input {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        margin-bottom: var(--space-sm);
    }
    .player-name-input label {
        font-family: var(--font-display);
        font-size: 0.8rem;
        white-space: nowrap;
    }
    .player-name-input input {
        flex: 1;
        padding: var(--space-xs) var(--space-sm);
        border: 2px solid var(--parchment-dark);
        border-radius: 6px;
        font-family: var(--font-body);
        font-size: 0.85rem;
    }
    .player-name-input input:focus {
        outline: none;
        border-color: var(--gold);
    }
    .player-stats-summary {
        font-size: 0.75rem;
        color: var(--ink-light);
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-sm);
    }
    .player-stat-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .leaderboard-tabs {
        display: flex;
        overflow-x: auto;
        border-bottom: 2px solid var(--parchment-dark);
        background: rgba(255, 255, 255, 0.3);
    }
    .leaderboard-tab {
        flex: 0 0 auto;
        padding: var(--space-sm) var(--space-md);
        background: transparent;
        border: none;
        font-family: var(--font-display);
        font-size: 0.75rem;
        cursor: pointer;
        color: var(--ink-light);
        position: relative;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 4px;
    }
    .leaderboard-tab:hover { color: var(--ink); }
    .leaderboard-tab.active { color: var(--ink); }
    .leaderboard-tab.active::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gold);
    }
    .leaderboard-tab .tab-icon { font-size: 1rem; }

    .leaderboard-list {
        padding: var(--space-sm) var(--space-md);
        max-height: 300px;
        overflow-y: auto;
    }
    .leaderboard-loading, .leaderboard-empty {
        text-align: center;
        color: var(--ink-light);
        padding: var(--space-lg);
        font-style: italic;
    }
    .leaderboard-entry {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        padding: var(--space-sm);
        background: rgba(255, 255, 255, 0.5);
        border-radius: 6px;
        margin-bottom: var(--space-xs);
        transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .leaderboard-entry:hover {
        transform: translateX(4px);
        box-shadow: var(--shadow-light);
    }
    .leaderboard-entry.highlight {
        background: rgba(201, 162, 39, 0.2);
        border: 2px solid var(--gold);
    }
    .leaderboard-rank {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: var(--font-display);
        font-weight: 700;
        font-size: 0.8rem;
        background: var(--parchment-dark);
        color: var(--ink);
    }
    .leaderboard-rank.gold { background: linear-gradient(135deg, #ffd700, #c9a227); color: #5c4830; }
    .leaderboard-rank.silver { background: linear-gradient(135deg, #e8e8e8, #c0c0c0); color: #444; }
    .leaderboard-rank.bronze { background: linear-gradient(135deg, #cd7f32, #a0522d); color: #fff; }
    .leaderboard-info { flex: 1; min-width: 0; }
    .leaderboard-name {
        font-family: var(--font-display);
        font-size: 0.85rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .leaderboard-meta {
        font-size: 0.65rem;
        color: var(--ink-light);
        display: flex;
        gap: var(--space-sm);
    }
    .leaderboard-score {
        font-family: var(--font-display);
        font-weight: 700;
        font-size: 0.9rem;
        color: var(--gold-dark);
        white-space: nowrap;
    }
    .faction-icon-small { font-size: 0.8rem; }

    .leaderboard-actions {
        display: flex;
        gap: var(--space-sm);
        padding: var(--space-sm) var(--space-md);
        border-top: 2px solid var(--parchment-dark);
    }
    .leaderboard-actions button { flex: 1; }

    .leaderboard-status {
        padding: 0 var(--space-md) var(--space-sm);
        font-size: 0.75rem;
        text-align: center;
        min-height: 20px;
    }
    .leaderboard-status.success { color: #1e7d34; }
    .leaderboard-status.error { color: var(--blood-red); }
    .leaderboard-status.info { color: var(--ink-light); }

    /* Leaderboard not configured state */
    .leaderboard-not-configured {
        text-align: center;
        padding: var(--space-xl);
        color: var(--ink-light);
    }
    .leaderboard-not-configured h3 {
        font-family: var(--font-display);
        color: var(--ink);
        margin-bottom: var(--space-sm);
    }
    .leaderboard-not-configured p {
        font-size: 0.85rem;
        margin-bottom: var(--space-sm);
    }
    .leaderboard-not-configured code {
        display: block;
        background: rgba(0, 0, 0, 0.1);
        padding: var(--space-sm);
        border-radius: 4px;
        font-size: 0.75rem;
        margin-top: var(--space-sm);
    }
